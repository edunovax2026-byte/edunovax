<!DOCTYPE html>
<html>
<head>
  <title>Admin Panel</title>
  <meta name="viewport" content="width=device-width, initial-scale=1.0">

<style>
*{margin:0;padding:0;box-sizing:border-box;}

body{
  font-family:'Segoe UI',sans-serif;  
  background:linear-gradient(135deg,#4facfe,#00f2fe);
}

/* LOGIN */
#loginSection{
  background:white;
  padding:35px;
  border-radius:15px;
  width:320px;
  position:absolute;
  top:50%;
  left:50%;
  transform:translate(-50%,-50%);
  box-shadow:0 10px 25px rgba(0,0,0,0.2);
}

input, textarea{
  width:100%;
  padding:10px;
  margin:8px 0;
  border-radius:8px;
  border:1px solid #ddd;
}

button{
  width:100%;
  padding:10px;
  border:none;
  border-radius:8px;
  background:#2563eb;
  color:white;
  font-weight:bold;
  cursor:pointer;
}

/* DASHBOARD */
#adminPanel {
  display: flex;
  flex-direction: row;
  min-height: 100vh;
  flex-wrap: wrap;
}

/* Sidebar */
.sidebar {
  width: 220px;
  background: #1e293b;
  color: white;
  padding: 20px;
  flex-shrink: 0;
}

.sidebar li{
  list-style:none;
  padding:12px;
  margin-top:8px;
  cursor:pointer;
  border-radius:6px;
}

.sidebar li:hover{background:#334155;}

/* Main content */
.mainContent{
  flex: 1;
  padding:25px;
  background:#f1f5f9;
  min-width: 300px;
}

.card{
  background:white;
  padding:20px;
  border-radius:12px;
  margin-bottom:20px;
  box-shadow:0 4px 10px rgba(0,0,0,0.08);
}

.listItem{
  background:#f8fafc;
  padding:10px;
  border-radius:8px;
  margin-top:8px;
  display:flex;
  justify-content:space-between;
  align-items:center;
}

.listItem button{
  width:auto;
  padding:5px 10px;
  margin-left:5px;
  font-size:13px;
}

/* Responsive adjustments */
@media (max-width: 768px) {
  #adminPanel {
    flex-direction: column;
  }

  .sidebar {
    width: 100%;
    display: flex;
    flex-direction: row;
    overflow-x: auto;
    padding: 10px;
  }

  .sidebar h2 {
    flex: 1 0 auto;
    font-size: 18px;
  }

  .sidebar li {
    flex: 0 0 auto;
    margin-right: 10px;
  }

  .mainContent {
    padding: 15px;
  }

  #loginSection {
    width: 90%;
    padding: 25px;
  }
}
</style>
</head>
<body>

<!-- LOGIN -->
<div id="loginSection">
  <h2>Admin Login</h2>
  <input type="email" id="email" placeholder="Email">
  <input type="password" id="password" placeholder="Password">
  <button id="loginBtn">Login</button>
</div>

<!-- DASHBOARD -->
<div id="adminPanel" style="display:none;">

  <div class="sidebar">
    <h2>Admin</h2>
    <li onclick="showSection('notesSection')">ðŸ“„ Notes</li>
    <li onclick="showSection('mcqSection')">ðŸ§  MCQ</li>
    <li id="logoutBtn">ðŸšª Logout</li>
  </div>

  <div class="mainContent">

    <!-- NOTES -->
    <div id="notesSection" class="card">
      <h3>Upload Notes</h3>
      <form id="uploadForm">
        <input id="title" placeholder="Title" required>
        <input id="subject" placeholder="Subject" required>
        <input id="className" placeholder="Class" required>
        <input id="driveFileId" placeholder="Drive File ID" required>
        <button type="submit">Upload</button>
      </form>

      <h3>Uploaded Notes</h3>
      <div id="notesList"></div>
    </div>

    <!-- MCQ -->
    <div id="mcqSection" class="card" style="display:none;">

      <h3>Upload / Edit MCQ</h3>
      <form id="mcqForm">
        <textarea id="mcqQuestion" placeholder="Question" required></textarea>

        <input id="opt1" placeholder="Option 1" required>
        <input id="opt2" placeholder="Option 2" required>
        <input id="opt3" placeholder="Option 3" required>
        <input id="opt4" placeholder="Option 4" required>

        <input id="correctAns" placeholder="Correct Answer (A/B/C/D)" required>

        <input id="mcqSubject" placeholder="Subject">
        <input id="mcqChapter" placeholder="Chapter">

        <button id="saveBtn" type="submit">Save MCQ</button>
      </form>

      <hr><br>

      <h3>Bulk MCQ Upload</h3>
      <input id="bulkSubject" placeholder="Subject for all MCQs">
      <input id="bulkChapter" placeholder="Chapter for all MCQs">

<textarea id="bulkMCQ" placeholder="
1. What is CPU?
A. Central Process Unit
B. Central Processing Unit
C. Computer Personal Unit
D. None
Answer: B
"></textarea>

      <button onclick="uploadBulkMCQ()">Upload Bulk MCQ</button>

      <hr><br>

      <h3>MCQ List</h3>
      <div id="mcqList"></div>

    </div>

  </div>
</div>

<script type="module">
import { initializeApp } from "https://www.gstatic.com/firebasejs/10.12.0/firebase-app.js";
import {
  getAuth, signInWithEmailAndPassword,
  onAuthStateChanged, signOut,
  setPersistence, browserSessionPersistence
} from "https://www.gstatic.com/firebasejs/10.12.0/firebase-auth.js";

import {
  getFirestore, collection, addDoc, serverTimestamp,
  getDocs, deleteDoc, doc, updateDoc
} from "https://www.gstatic.com/firebasejs/10.12.0/firebase-firestore.js";

const firebaseConfig = {
  apiKey: "AIzaSyBpasI_y-aIGFldPiv2DwJit0S7XhG5jkk",
  authDomain: "projectx-58a7e.firebaseapp.com",
  projectId: "projectx-58a7e",
  storageBucket: "projectx-58a7e.firebasestorage.app",
  messagingSenderId: "352189023227",
  appId: "1:352189023227:web:7f93f838432329b42e815e"
};

const app = initializeApp(firebaseConfig);
const auth = getAuth(app);
const db = getFirestore(app);

setPersistence(auth, browserSessionPersistence);

let editId = null;

// ================== ADMIN LOGIN ==================
loginBtn.onclick = () => {
  signInWithEmailAndPassword(auth, email.value, password.value)
    .catch(err => alert(err.message));
};

onAuthStateChanged(auth, user => {
  if(user){
    if(user.email !== "edunovax2026@gmail.com"){
      alert("Unauthorized user âŒ");
      signOut(auth);
      return;
    }
    loginSection.style.display="none";
    adminPanel.style.display="flex";
    loadNotes();
    loadMCQs();
  } else {
    loginSection.style.display="block";
    adminPanel.style.display="none";
  }
});

logoutBtn.onclick = () => signOut(auth);

window.showSection=id=>{
  notesSection.style.display="none";
  mcqSection.style.display="none";
  document.getElementById(id).style.display="block";
};

//////////////// NOTES //////////////////
uploadForm.onsubmit=async e=>{
  e.preventDefault();
  await addDoc(collection(db,"notes"),{
    title:title.value,
    subject:subject.value,
    class:className.value,
    driveFileId:driveFileId.value,
    downloads:0,
    createdAt:serverTimestamp()
  });
  uploadForm.reset();
  loadNotes();
};

async function loadNotes(){
  const snap=await getDocs(collection(db,"notes"));
  notesList.innerHTML="";
  snap.forEach(d=>{
    const n=d.data();
    notesList.innerHTML+=`
    <div class="listItem">
      <div><b>${n.title}</b><br>${n.subject}</div>
      <button onclick="deleteNote('${d.id}')">Delete</button>
    </div>`;
  });
}

window.deleteNote=async id=>{
  if(confirm("Delete note?")){
    await deleteDoc(doc(db,"notes",id));
    loadNotes();
  }
};

//////////////// MCQ SAVE / UPDATE //////////////////
mcqForm.onsubmit=async e=>{
  e.preventDefault();

  const map={A:opt1.value,B:opt2.value,C:opt3.value,D:opt4.value};
  let ans=correctAns.value.trim().toUpperCase();
  if(map[ans]) ans=map[ans];

  const data={
    question:mcqQuestion.value,
    option1:opt1.value,
    option2:opt2.value,
    option3:opt3.value,
    option4:opt4.value,
    answer:ans,
    subject:mcqSubject.value,
    chapter:mcqChapter.value,
    createdAt:serverTimestamp()
  };

  if(editId){
    await updateDoc(doc(db,"mcqs",editId),data);
    editId=null;
    saveBtn.innerText="Save MCQ";
  }else{
    await addDoc(collection(db,"mcqs"),data);
  }

  mcqForm.reset();
  loadMCQs();
};

//////////////// LOAD MCQ //////////////////
async function loadMCQs(){
  const snap=await getDocs(collection(db,"mcqs"));
  mcqList.innerHTML="";
  snap.forEach(d=>{
    const m=d.data();
    mcqList.innerHTML+=`
    <div class="listItem">
      <div>
        <b>${m.question}</b><br>
        ${m.subject || ""} | ${m.chapter || ""}
      </div>
      <div>
        <button onclick="editMCQ('${d.id}',
          \`${m.question}\`,
          \`${m.option1}\`,
          \`${m.option2}\`,
          \`${m.option3}\`,
          \`${m.option4}\`,
          \`${m.answer}\`,
          \`${m.subject || ""}\`,
          \`${m.chapter || ""}\`
        )">Edit</button>
        <button onclick="deleteMCQ('${d.id}')">Delete</button>
      </div>
    </div>`;
  });
}

window.editMCQ=(id,q,o1,o2,o3,o4,ans,sub,chap)=>{
  editId=id;
  mcqQuestion.value=q;
  opt1.value=o1;
  opt2.value=o2;
  opt3.value=o3;
  opt4.value=o4;
  correctAns.value=ans;
  mcqSubject.value=sub;
  mcqChapter.value=chap;
  saveBtn.innerText="Update MCQ";
  window.scrollTo({top:0,behavior:"smooth"});
};

window.deleteMCQ=async id=>{
  if(confirm("Delete MCQ?")){
    await deleteDoc(doc(db,"mcqs",id));
    loadMCQs();
  }
};

//////////////// BULK UPLOAD //////////////////
window.uploadBulkMCQ=async()=>{
  const text=bulkMCQ.value.trim();
  const subject=bulkSubject.value;
  const chapter=bulkChapter.value;

  if(!text){ alert("Paste MCQs"); return; }

  const blocks=text.split(/\n\s*\n/);
  let added=0;

  for(const block of blocks){
    const lines=block.split("\n").map(l=>l.trim());
    if(lines.length<6) continue;

    const question=lines[0].replace(/^\d+\.\s*/,"");
    const option1=lines[1].replace(/^A\.\s*/i,"");
    const option2=lines[2].replace(/^B\.\s*/i,"");
    const option3=lines[3].replace(/^C\.\s*/i,"");
    const option4=lines[4].replace(/^D\.\s*/i,"");
    const letter=lines[5].split(":")[1].trim().toUpperCase();

    const map={A:option1,B:option2,C:option3,D:option4};

    await addDoc(collection(db,"mcqs"),{
      question,option1,option2,option3,option4,
      answer:map[letter],
      subject,chapter,
      createdAt:serverTimestamp()
    });

    added++;
  }

  alert(added+" MCQs uploaded âœ…");
  bulkMCQ.value="";
  loadMCQs();
};
</script>
</body>
</html>
